#parentapp login
curl -X POST https://school.snaildiverse.com/api/parent-portal/login/ \
-H "Content-Type: application/json" \
-d '{
  "username": "10680bqq",
  "password": "12345678"
}'

#parentapp get student
curl -X GET https://school.snaildiverse.com/api/parent-portal/students/ \
-H "Content-Type: application/json" \
-H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2NTA3ZWM3ZTE1MTNiZmU2ZGVmNDEwYjIiLCJ1c2VybmFtZSI6IjEwNjgwQlFRIiwiaW5zdGl0dXRlSWQiOiI2NGY3YjI2ZTM3YjNjMWZmM2EyODAzMDQiLCJzdWIiOiI2NTA3ZWM3ZTE1MTNiZmU2ZGVmNDEwYjIiLCJhcHAiOiJwYXJlbnQiLCJpYXQiOjE3NDk3MTM5OTksImV4cCI6MTc1MDA3Mzk5OSwiYXVkIjoiaHR0cHM6Ly9zY2hvb2wuc25haWxkaXZlcnNlLmNvbSIsImlzcyI6Imh0dHBzOi8vc2Nob29sLnNuYWlsZGl2ZXJzZS5jb20ifQ.I_pThDbVzbASKWGXe8qs-RWo4sqpJRI79BUgO2AsBwH_bbCj1yKwSwrKbyNxsws4dX8weIiEghqw0pOLGZSnIw43yYQY9aH5xU8ZQ2c7ljvk04Xd9OdBxvBfap-hZlxJMpTnDSlewUDFcbk13_Il1SSrounDhr8jXcPPMIs3yVUXXHdC2qxesUIsfoIos9klQrOyDYaBScUxmgnCUyUTn_aMySO509op4QbSSLyEDbGnikXUoc-fYoVFsQMcIG9wSh37TSF-kRb-qZzFkxJZt2TG5Q-r-KXByUQ7F7Ip-9GlRggog5HcHH_bDGylmmM9V3xcOXhJrzg7iFF1EjU4jOVU4qhmFGafJVnYiUQZw3J8XbJko1cOqF1bi3w0PAhRudplZWa899j9D3_yjgVwPyOGcohhHMBxA1K0XqdKqax5fUTPbU7uFj2NL0VK6sbfagXxU4MFiJ6DiRT7fTDm2mPfZ3YG3nB9MJwGzyhd0x5wKq98YdEVqmBI7N0SXepB1fyyw4yw0Z3RXysf20kG9dKXldgfcYpZfWxZj6vI42KgGT6li5bmYqX2FSnf86_jdkQ6JmZuvcmKpwZt0wLxTku_RKwrBUgoj07JSr1_bQCDK4GAO7wlichcA-yyco18FINM7zCBQSSMZ-ukhldXfXm5kFcnIlFnEogAIiVQEwo"



{"refresh":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc1MjMxNTQ1NSwiaWF0IjoxNzQ5NzIzNDU1LCJqdGkiOiJkZDk1MGQ4N2RjYmE0NWY5OTMzMWMxMzJhMWJlZDQ2MSIsInVzZXJfaWQiOjN9.7V2120gGTRlJEztmR3sUYaqQ7bopJOXVPrtknaMv9mY",
"access":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzUwNTg3NDU1LCJpYXQiOjE3NDk3MjM0NTUsImp0aSI6ImMzMzFkZWVmN2M4OTQ2NDliZmY4ZmE0YzliNWI3MjhjIiwidXNlcl9pZCI6M30.SYRZVIhz_oOk7DYxhZqe41n7SyGh2de8_NzXmMMZays"}
#verify OTP
curl -X POST http://localhost:8081/api/accounts/verify-otp/ \
-H "Content-Type: application/json" \
-d '{
  "email": "kevin@snaildy.com",
  "otp": "644792"
}'

#login
curl -X POST http://localhost:8081/api/accounts/login/ \
-H "Content-Type: application/json" \
-d '{
  "identifier": "kevin@snaildy.com",
  "password": "123456"
}'

#register
curl -X POST http://localhost:8081/api/accounts/register/ \
-H "Content-Type: application/json" \
-d '{
  "email": "kevin@snaildy.com",
  "password": "123456",
  "login_method": "email",
  "first_name": "Kevin",
  "last_name": "Snaildy"
}'

#refresh token
curl -X POST http://127.0.0.1:8081/api/accounts/token/refresh/ \
-H "Content-Type: application/json" \
-d '{
"refresh" : "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc0ODM5ODU3NiwiaWF0IjoxNzQ4MzEyMTc2LCJqdGkiOiI2YzQ5NDNkNjYwZTI0MTk4OGQxMzgxZTI3ZDA5MDgzNyIsInVzZXJfaWQiOjExfQ.u9Ovr06o24dWC0-pFrnvDVuSdODzeMRWOgQ1LrrsoQA"
}'

#bind student acc
curl -X POST http://localhost:8081/api/student/bind-student/ \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzUwNTg3NDU1LCJpYXQiOjE3NDk3MjM0NTUsImp0aSI6ImMzMzFkZWVmN2M4OTQ2NDliZmY4ZmE0YzliNWI3MjhjIiwidXNlcl9pZCI6M30.SYRZVIhz_oOk7DYxhZqe41n7SyGh2de8_NzXmMMZays" \
-H "Content-Type: application/json" \
-d '{
  "student_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2NTA3ZWM3ZTE1MTNiZmU2ZGVmNDEwYjIiLCJ1c2VybmFtZSI6IjEwNjgwQlFRIiwiaW5zdGl0dXRlSWQiOiI2NGY3YjI2ZTM3YjNjMWZmM2EyODAzMDQiLCJzdWIiOiI2NTA3ZWM3ZTE1MTNiZmU2ZGVmNDEwYjIiLCJhcHAiOiJwYXJlbnQiLCJpYXQiOjE3NDk3MTM5OTksImV4cCI6MTc1MDA3Mzk5OSwiYXVkIjoiaHR0cHM6Ly9zY2hvb2wuc25haWxkaXZlcnNlLmNvbSIsImlzcyI6Imh0dHBzOi8vc2Nob29sLnNuYWlsZGl2ZXJzZS5jb20ifQ.I_pThDbVzbASKWGXe8qs-RWo4sqpJRI79BUgO2AsBwH_bbCj1yKwSwrKbyNxsws4dX8weIiEghqw0pOLGZSnIw43yYQY9aH5xU8ZQ2c7ljvk04Xd9OdBxvBfap-hZlxJMpTnDSlewUDFcbk13_Il1SSrounDhr8jXcPPMIs3yVUXXHdC2qxesUIsfoIos9klQrOyDYaBScUxmgnCUyUTn_aMySO509op4QbSSLyEDbGnikXUoc-fYoVFsQMcIG9wSh37TSF-kRb-qZzFkxJZt2TG5Q-r-KXByUQ7F7Ip-9GlRggog5HcHH_bDGylmmM9V3xcOXhJrzg7iFF1EjU4jOVU4qhmFGafJVnYiUQZw3J8XbJko1cOqF1bi3w0PAhRudplZWa899j9D3_yjgVwPyOGcohhHMBxA1K0XqdKqax5fUTPbU7uFj2NL0VK6sbfagXxU4MFiJ6DiRT7fTDm2mPfZ3YG3nB9MJwGzyhd0x5wKq98YdEVqmBI7N0SXepB1fyyw4yw0Z3RXysf20kG9dKXldgfcYpZfWxZj6vI42KgGT6li5bmYqX2FSnf86_jdkQ6JmZuvcmKpwZt0wLxTku_RKwrBUgoj07JSr1_bQCDK4GAO7wlichcA-yyco18FINM7zCBQSSMZ-ukhldXfXm5kFcnIlFnEogAIiVQEwo"
}'

#get all binded student tokens
curl -X GET http://127.0.0.1:8081/api/student/get-all-binded-student-tokens/ \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ5Njk5MjUyLCJpYXQiOjE3NDg4MzUyNTIsImp0aSI6IjY5ZTllYmMwMmRkNjRmZWZiYWUyZDM0NmMwYjc3N2FhIiwidXNlcl9pZCI6M30.8h37nMPeaI3RzBaoxCKYeFfWNmHxDaUuyXbkeb7AvYU" \
-H "Content-Type: application/json" \

#add student
curl -X POST http://localhost:8081/api/student/add/ \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzUwNTg3NDU1LCJpYXQiOjE3NDk3MjM0NTUsImp0aSI6ImMzMzFkZWVmN2M4OTQ2NDliZmY4ZmE0YzliNWI3MjhjIiwidXNlcl9pZCI6M30.SYRZVIhz_oOk7DYxhZqe41n7SyGh2de8_NzXmMMZays" \
  -H "Content-Type: application/json" \
  -d '{
        "strn": "A12345678",
        "id_no": "Z123456(7)",
        "chinese_name": "中文名",
        "english_name": "Testing ggg",
        "school": "19",
        "grade": "primary_3",
        "date_of_birth": "2010-05-15"
      }'


docker start snaildy_parent_backend-web-1
docker start snaildy_parent_backend-db-1

docker exec -t snaildy_parent_backend-db-1 pg_dump -U kevinleung snaildy-parent-db > backup_$(date +%F_%T).sql
find . -path "*/migrations/*.py" -not -name "__init__.py" -delete
find . -path "*/migrations/*.pyc" -delete

docker-compose exec web python manage.py makemigrations
docker-compose exec web python manage.py migrate

docker exec -it snaildy_parent_backend-db-1 psql -U kevinleung -d snaildy_parent_db
ALTER TABLE service_service
ADD COLUMN type varchar(20) NOT NULL DEFAULT 'one-time';

docker restart snaildy_parent_backend-db-1
docker restart snaildy_parent_backend-web-1

docker exec -it snaildy_parent_backend-web-1 python manage.py makemigrations
docker exec -it snaildy_parent_backend-web-1 python manage.py migrate


# Backup (optional)
docker exec -t snaildy_parent_backend-db-1 pg_dump -U postgres snaildy-parent-db > backup.sql

# Delete migration files
find . -path "*/migrations/*.py" ! -name "__init__.py" -delete
find . -path "*/migrations/*.pyc" -delete

# Drop and recreate schema
docker exec -it snaildy_parent_backend-db-1 psql -U postgres -d snaildy-parent-db
# Inside psql:
# DROP SCHEMA public CASCADE;
# CREATE SCHEMA public;
# GRANT ALL ON SCHEMA public TO postgres;
# \q

# Create migrations and migrate
docker exec -it snaildy_parent_backend-web-1 python manage.py makemigrations student
docker exec -it snaildy_parent_backend-web-1 python manage.py migrate
python3 manage.py migrate student
python3 manage.py migrate service
python3 manage.py migrate activity_record
# Restart Django app
docker restart snaildy_parent_backend-web-1



docker-compose down -v --remove-orphans

docker volume prune -f

docker-compose up -d --build

docker-compose exec web python manage.py migrate

docker-compose exec web python manage.py createsuperuser

#maintenance_mode
docker-compose exec web python manage.py maintenance_mode on
docker-compose exec web python manage.py maintenance_mode off

#local
docker exec -it local-web-1 python manage.py makemigrations

#run on aws
docker-compose --env-file .env-staging -p staging -f docker-compose.yml -f docker-compose.staging.yml up --build
docker-compose --env-file .env-prod -p prod -f docker-compose.yml -f docker-compose.prod.yml up --build
#testing for local
docker-compose --env-file .env-staging -p local -f docker-compose.yml -f docker-compose.local.yml up --build
docker-compose --env-file .env-staging -p local -f docker-compose.yml -f docker-compose.local.yml run --rm web python manage.py startapp sen
docker-compose --env-file .env-staging -p staging -f docker-compose.yml -f docker-compose.staging.yml up --build


#startapp in local file system
docker exec -it local-web-1 sh
python manage.py startapp coupon


#connect aws
ssh -i /Users/snaildymac/aws-keys/kevin-snaildy.pem ec2-user@44.212.59.59


#docker 
docker buildx build --platform linux/amd64,linux/arm64 -t kevinleung227/snaildy-parent:staging  --push .
#aws
docker compose --env-file .env-staging -p staging -f docker-compose.yml -f docker-compose.staging.yml up --build -d
##### Remember set security group on aws 8081,8082